<!DOCTYPE html>
<html>
<head>
    <title>Firebase Auth Test</title>
</head>
<body>
    <h1>Firebase Authentication Test</h1>
    <button id="testAuthBtn">Test Google Auth</button>
    <button id="signOutBtn" style="display:none;">Sign Out</button>
    <div id="status"></div>
    <div id="userInfo"></div>

    <script type="module">
        import { auth } from './firebase-config.js';
        import { signInWithPopup, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

        const status = document.getElementById('status');
        const userInfo = document.getElementById('userInfo');
        const testAuthBtn = document.getElementById('testAuthBtn');
        const signOutBtn = document.getElementById('signOutBtn');

        // Auth state observer
        auth.onAuthStateChanged((user) => {
            console.log("Auth State Changed:", user ? user.email : "No user");
            if (user) {
                status.innerHTML = '<p style="color: green;">‚úÖ Authentication successful!</p>';
                userInfo.innerHTML = `
                    <p><strong>User:</strong> ${user.displayName || 'N/A'}</p>
                    <p><strong>Email:</strong> ${user.email}</p>
                    <p><strong>UID:</strong> ${user.uid}</p>
                `;
                testAuthBtn.style.display = 'none';
                signOutBtn.style.display = 'inline-block';
            } else {
                status.innerHTML = '<p style="color: red;">‚ùå Not authenticated</p>';
                userInfo.innerHTML = '';
                testAuthBtn.style.display = 'inline-block';
                signOutBtn.style.display = 'none';
            }
        });

        // Test authentication
        testAuthBtn.addEventListener('click', async () => {
            console.log("Testing Google Authentication...");
            status.innerHTML = '<p style="color: blue;">üîÑ Testing authentication...</p>';
            
            const provider = new GoogleAuthProvider();
            provider.setCustomParameters({ prompt: 'select_account' });
            
            try {
                const result = await signInWithPopup(auth, provider);
                console.log("‚úÖ Auth Success:", result.user);
            } catch (error) {
                console.error("‚ùå Auth Error:", error);
                status.innerHTML = `<p style="color: red;">‚ùå Error: ${error.code} - ${error.message}</p>`;
            }
        });

        // Sign out
        signOutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                console.log("Signed out successfully");
            } catch (error) {
                console.error("Sign out error:", error);
            }
        });

        // Log Firebase config (without sensitive data)
        console.log("Firebase initialized with project:", auth.app.options.projectId);
    </script>
</body>
</html>
